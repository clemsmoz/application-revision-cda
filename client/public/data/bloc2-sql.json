{
  "id": "bloc2-sql",
  "bloc": "bloc2",
  "title": "SQL : D√©veloppement de Bases de Donn√©es",
  "icon": "üóÑÔ∏è",
  "color": "#10B981",
  "description": "SQL (Structured Query Language) est le langage standard pour interagir avec les bases de donn√©es relationnelles. Il permet de cr√©er, interroger, modifier et g√©rer des donn√©es structur√©es.",
  "sections": [
    {
      "id": "intro",
      "title": "Introduction aux Bases de Donn√©es Relationnelles",
      "content": [
        {
          "type": "definition",
          "term": "Base de Donn√©es Relationnelle",
          "definition": "Syst√®me de gestion de donn√©es organis√©es en tables (relations) compos√©es de lignes (enregistrements) et de colonnes (attributs). Les tables sont li√©es entre elles par des cl√©s."
        },
        {
          "type": "paragraph",
          "text": "Le mod√®le relationnel repose sur la **th√©orie des ensembles** et l'**alg√®bre relationnelle**. Les donn√©es sont structur√©es et respectent des contraintes d'int√©grit√©."
        },
        {
          "type": "table",
          "headers": [
            "Concept",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "Table (Relation)",
              "Collection de donn√©es organis√©es en lignes et colonnes",
              "Table `users`"
            ],
            [
              "Ligne (Tuple)",
              "Enregistrement unique dans une table",
              "Un utilisateur sp√©cifique"
            ],
            [
              "Colonne (Attribut)",
              "Propri√©t√© d'un enregistrement",
              "`nom`, `email`, `age`"
            ],
            [
              "Cl√© Primaire (PK)",
              "Identifiant unique d'une ligne",
              "`id` (auto-incr√©ment√©)"
            ],
            [
              "Cl√© √âtrang√®re (FK)",
              "R√©f√©rence vers une cl√© primaire d'une autre table",
              "`user_id` dans `orders`"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "SGBDR Populaires"
        },
        {
          "type": "table",
          "headers": [
            "SGBDR",
            "Type",
            "Utilisation"
          ],
          "rows": [
            [
              "MySQL / MariaDB",
              "Open Source",
              "Web, applications g√©n√©rales"
            ],
            [
              "PostgreSQL",
              "Open Source",
              "Applications complexes, donn√©es g√©ospatiales"
            ],
            [
              "SQLite",
              "Embarqu√©",
              "Applications mobiles, prototypes"
            ],
            [
              "Oracle",
              "Commercial",
              "Grandes entreprises"
            ],
            [
              "SQL Server",
              "Commercial (Microsoft)",
              "Environnements Windows, .NET"
            ]
          ]
        }
      ]
    },
    {
      "id": "ldd",
      "title": "LDD : Langage de D√©finition de Donn√©es",
      "content": [
        {
          "type": "paragraph",
          "text": "Le **LDD** (DDL en anglais) permet de d√©finir la structure de la base de donn√©es : cr√©er, modifier et supprimer des tables, des index, etc."
        },
        {
          "type": "subtitle",
          "text": "CREATE TABLE (Cr√©er une Table)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "CREATE TABLE users (\n  id INT PRIMARY KEY AUTO_INCREMENT,\n  name VARCHAR(100) NOT NULL,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  age INT CHECK (age >= 18),\n  date_inscription DATETIME DEFAULT CURRENT_TIMESTAMP\n);"
        },
        {
          "type": "table",
          "headers": [
            "Type de Donn√©es",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "INT",
              "Entier",
              "age INT"
            ],
            [
              "VARCHAR(n)",
              "Cha√Æne de caract√®res (longueur variable)",
              "nom VARCHAR(100)"
            ],
            [
              "TEXT",
              "Texte long",
              "description TEXT"
            ],
            [
              "DATE",
              "Date (YYYY-MM-DD)",
              "date_naissance DATE"
            ],
            [
              "DATETIME",
              "Date et heure",
              "created_at DATETIME"
            ],
            [
              "BOOLEAN",
              "Vrai/Faux",
              "is_active BOOLEAN"
            ],
            [
              "DECIMAL(p,s)",
              "Nombre d√©cimal (pr√©cision, √©chelle)",
              "prix DECIMAL(10,2)"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "Contraintes d'Int√©grit√©"
        },
        {
          "type": "table",
          "headers": [
            "Contrainte",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "PRIMARY KEY",
              "Identifiant unique de la ligne",
              "id INT PRIMARY KEY"
            ],
            [
              "FOREIGN KEY",
              "R√©f√©rence vers une autre table",
              "FOREIGN KEY (user_id) REFERENCES users(id)"
            ],
            [
              "UNIQUE",
              "Valeur unique dans la colonne",
              "email VARCHAR(255) UNIQUE"
            ],
            [
              "NOT NULL",
              "Valeur obligatoire",
              "nom VARCHAR(100) NOT NULL"
            ],
            [
              "CHECK",
              "Condition √† respecter",
              "age INT CHECK (age >= 18)"
            ],
            [
              "DEFAULT",
              "Valeur par d√©faut",
              "created_at DATETIME DEFAULT CURRENT_TIMESTAMP"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "ALTER TABLE (Modifier une Table)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Ajouter une colonne\nALTER TABLE users ADD COLUMN telephone VARCHAR(20);\n\n-- Modifier une colonne\nALTER TABLE users MODIFY COLUMN name VARCHAR(150);\n\n-- Supprimer une colonne\nALTER TABLE users DROP COLUMN telephone;\n\n-- Ajouter une contrainte\nALTER TABLE users ADD CONSTRAINT fk_role\n  FOREIGN KEY (role_id) REFERENCES roles(id);"
        },
        {
          "type": "subtitle",
          "text": "DROP TABLE (Supprimer une Table)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Supprimer une table\nDROP TABLE users;\n\n-- Supprimer si elle existe (√©vite les erreurs)\nDROP TABLE IF EXISTS users;"
        }
      ]
    },
    {
      "id": "lmd",
      "title": "LMD : Langage de Manipulation de Donn√©es",
      "content": [
        {
          "type": "paragraph",
          "text": "Le **LMD** (DML en anglais) permet de manipuler les donn√©es : ins√©rer, lire, modifier et supprimer des enregistrements."
        },
        {
          "type": "subtitle",
          "text": "INSERT (Ins√©rer des Donn√©es)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Ins√©rer un enregistrement\nINSERT INTO users (name, email, age)\nVALUES ('Alice', 'alice@example.com', 25);\n\n-- Ins√©rer plusieurs enregistrements\nINSERT INTO users (name, email, age) VALUES\n  ('Bob', 'bob@example.com', 30),\n  ('Charlie', 'charlie@example.com', 28);\n\n-- Ins√©rer avec toutes les colonnes (dans l'ordre)\nINSERT INTO users\nVALUES (NULL, 'David', 'david@example.com', 35, NOW());"
        },
        {
          "type": "subtitle",
          "text": "SELECT (Interroger des Donn√©es)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- S√©lectionner toutes les colonnes\nSELECT * FROM users;\n\n-- S√©lectionner des colonnes sp√©cifiques\nSELECT name, email FROM users;\n\n-- Avec condition WHERE\nSELECT * FROM users WHERE age >= 25;\n\n-- Avec plusieurs conditions\nSELECT * FROM users\nWHERE age >= 25 AND email LIKE '%@example.com';\n\n-- Trier les r√©sultats\nSELECT * FROM users ORDER BY age DESC;\n\n-- Limiter le nombre de r√©sultats\nSELECT * FROM users LIMIT 10;\n\n-- Pagination\nSELECT * FROM users LIMIT 10 OFFSET 20; -- Page 3 (20 enregistrements saut√©s)"
        },
        {
          "type": "subtitle",
          "text": "Op√©rateurs de Comparaison"
        },
        {
          "type": "table",
          "headers": [
            "Op√©rateur",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "=",
              "√âgal",
              "age = 25"
            ],
            [
              "!=  ou  <>",
              "Diff√©rent",
              "age != 25"
            ],
            [
              ">",
              "Sup√©rieur",
              "age > 25"
            ],
            [
              "<",
              "Inf√©rieur",
              "age < 25"
            ],
            [
              ">=",
              "Sup√©rieur ou √©gal",
              "age >= 25"
            ],
            [
              "<=",
              "Inf√©rieur ou √©gal",
              "age <= 25"
            ],
            [
              "BETWEEN",
              "Entre deux valeurs",
              "age BETWEEN 20 AND 30"
            ],
            [
              "IN",
              "Dans une liste",
              "age IN (20, 25, 30)"
            ],
            [
              "LIKE",
              "Correspondance de motif",
              "nom LIKE 'A%' (commence par A)"
            ],
            [
              "IS NULL",
              "Valeur nulle",
              "email IS NULL"
            ],
            [
              "IS NOT NULL",
              "Valeur non nulle",
              "email IS NOT NULL"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "UPDATE (Modifier des Donn√©es)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Modifier un enregistrement\nUPDATE users\nSET age = 26\nWHERE id = 1;\n\n-- Modifier plusieurs colonnes\nUPDATE users\nSET name = 'Alice Dupont', age = 26\nWHERE id = 1;\n\n-- Modifier plusieurs enregistrements\nUPDATE users\nSET age = age + 1\nWHERE age < 30;"
        },
        {
          "type": "alert",
          "level": "danger",
          "text": "**‚ö†Ô∏è ATTENTION** : Toujours utiliser WHERE avec UPDATE et DELETE, sinon TOUTES les lignes seront modifi√©es/supprim√©es !"
        },
        {
          "type": "subtitle",
          "text": "DELETE (Supprimer des Donn√©es)"
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Supprimer un enregistrement\nDELETE FROM users WHERE id = 1;\n\n-- Supprimer plusieurs enregistrements\nDELETE FROM users WHERE age < 18;\n\n-- Vider la table (delete tous les enregistrements)\nDELETE FROM users; -- ‚ö†Ô∏è Dangereux !\n\n-- Ou mieux (plus rapide, r√©initialise les auto-incr√©ments)\nTRUNCATE TABLE users;"
        }
      ]
    },
    {
      "id": "jointures",
      "title": "Jointures (JOIN)",
      "content": [
        {
          "type": "paragraph",
          "text": "Les **jointures** permettent de combiner des donn√©es de plusieurs tables en fonction de relations entre elles."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Tables d'exemple\nCREATE TABLE users (\n  id INT PRIMARY KEY,\n  name VARCHAR(100)\n);\n\nCREATE TABLE orders (\n  id INT PRIMARY KEY,\n  user_id INT,\n  montant DECIMAL(10,2),\n  FOREIGN KEY (user_id) REFERENCES users(id)\n);"
        },
        {
          "type": "subtitle",
          "text": "INNER JOIN (Jointure Interne)"
        },
        {
          "type": "paragraph",
          "text": "Retourne uniquement les lignes ayant une correspondance dans les deux tables."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "SELECT users.name, orders.montant\nFROM users\nINNER JOIN orders ON users.id = orders.user_id;"
        },
        {
          "type": "subtitle",
          "text": "LEFT JOIN (Jointure Gauche)"
        },
        {
          "type": "paragraph",
          "text": "Retourne toutes les lignes de la table de gauche, m√™me si aucune correspondance dans la table de droite."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "SELECT users.name, orders.montant\nFROM users\nLEFT JOIN orders ON users.id = orders.user_id;\n-- Retourne tous les users, m√™me ceux sans commande (montant = NULL)"
        },
        {
          "type": "subtitle",
          "text": "RIGHT JOIN (Jointure Droite)"
        },
        {
          "type": "paragraph",
          "text": "Retourne toutes les lignes de la table de droite, m√™me si aucune correspondance dans la table de gauche."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "SELECT users.name, orders.montant\nFROM users\nRIGHT JOIN orders ON users.id = orders.user_id;\n-- Retourne toutes les commandes, m√™me celles sans user associ√©"
        },
        {
          "type": "table",
          "headers": [
            "Type de JOIN",
            "Description",
            "Cas d'usage"
          ],
          "rows": [
            [
              "INNER JOIN",
              "Correspondances uniquement",
              "Utilisateurs ayant pass√© des commandes"
            ],
            [
              "LEFT JOIN",
              "Toutes les lignes de gauche",
              "Tous les utilisateurs (avec ou sans commandes)"
            ],
            [
              "RIGHT JOIN",
              "Toutes les lignes de droite",
              "Toutes les commandes (avec ou sans utilisateur)"
            ],
            [
              "FULL OUTER JOIN",
              "Toutes les lignes des deux tables",
              "Rarement utilis√© (non support√© par MySQL)"
            ]
          ]
        }
      ]
    },
    {
      "id": "fonctions",
      "title": "Fonctions d'Agr√©gation",
      "content": [
        {
          "type": "paragraph",
          "text": "Les **fonctions d'agr√©gation** permettent de calculer des statistiques sur un ensemble de lignes."
        },
        {
          "type": "table",
          "headers": [
            "Fonction",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "COUNT()",
              "Compte le nombre de lignes",
              "SELECT COUNT(*) FROM users;"
            ],
            [
              "SUM()",
              "Somme des valeurs",
              "SELECT SUM(montant) FROM orders;"
            ],
            [
              "AVG()",
              "Moyenne des valeurs",
              "SELECT AVG(age) FROM users;"
            ],
            [
              "MIN()",
              "Valeur minimale",
              "SELECT MIN(age) FROM users;"
            ],
            [
              "MAX()",
              "Valeur maximale",
              "SELECT MAX(age) FROM users;"
            ]
          ]
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Nombre total d'users\nSELECT COUNT(*) AS total_users FROM users;\n\n-- √Çge moyen\nSELECT AVG(age) AS age_moyen FROM users;\n\n-- Montant total des commandes\nSELECT SUM(montant) AS total FROM orders;"
        },
        {
          "type": "subtitle",
          "text": "GROUP BY (Regroupement)"
        },
        {
          "type": "paragraph",
          "text": "**GROUP BY** permet de regrouper les r√©sultats par une ou plusieurs colonnes."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Nombre de commandes par user\nSELECT user_id, COUNT(*) AS nb_commandes\nFROM orders\nGROUP BY user_id;\n\n-- Montant total des commandes par user\nSELECT user_id, SUM(montant) AS total\nFROM orders\nGROUP BY user_id;\n\n-- Avec jointure\nSELECT users.name, COUNT(orders.id) AS nb_commandes\nFROM users\nLEFT JOIN orders ON users.id = orders.user_id\nGROUP BY users.id, users.name;"
        },
        {
          "type": "subtitle",
          "text": "HAVING (Filtrer les Groupes)"
        },
        {
          "type": "paragraph",
          "text": "**HAVING** filtre les r√©sultats apr√®s le regroupement (contrairement √† WHERE qui filtre avant)."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Utilisateurs ayant pass√© plus de 3 commandes\nSELECT user_id, COUNT(*) AS nb_commandes\nFROM orders\nGROUP BY user_id\nHAVING COUNT(*) > 3;\n\n-- Utilisateurs ayant d√©pens√© plus de 1000‚Ç¨\nSELECT user_id, SUM(montant) AS total\nFROM orders\nGROUP BY user_id\nHAVING SUM(montant) > 1000;"
        }
      ]
    },
    {
      "id": "sous-requetes",
      "title": "Sous-Requ√™tes (Subqueries)",
      "content": [
        {
          "type": "paragraph",
          "text": "Une **sous-requ√™te** est une requ√™te imbriqu√©e dans une autre requ√™te."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Utilisateurs ayant pass√© au moins une commande\nSELECT * FROM users\nWHERE id IN (SELECT DISTINCT user_id FROM orders);\n\n-- Utilisateurs ayant d√©pens√© plus que la moyenne\nSELECT * FROM users\nWHERE id IN (\n  SELECT user_id FROM orders\n  GROUP BY user_id\n  HAVING SUM(montant) > (SELECT AVG(montant) FROM orders)\n);\n\n-- Sous-requ√™te dans SELECT\nSELECT name,\n  (SELECT COUNT(*) FROM orders WHERE orders.user_id = users.id) AS nb_commandes\nFROM users;"
        }
      ]
    },
    {
      "id": "transactions",
      "title": "Transactions",
      "content": [
        {
          "type": "definition",
          "term": "Transaction",
          "definition": "Ensemble d'op√©rations SQL ex√©cut√©es comme une unit√© atomique. Soit toutes les op√©rations r√©ussissent (COMMIT), soit aucune n'est appliqu√©e (ROLLBACK)."
        },
        {
          "type": "paragraph",
          "text": "Les transactions garantissent les propri√©t√©s **ACID** : Atomicit√©, Coh√©rence, Isolation, Durabilit√©."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- D√©marrer une transaction\nSTART TRANSACTION;\n\n-- Op√©rations\nUPDATE comptes SET solde = solde - 100 WHERE id = 1;\nUPDATE comptes SET solde = solde + 100 WHERE id = 2;\n\n-- Valider la transaction\nCOMMIT;\n\n-- Ou annuler en cas d'erreur\nROLLBACK;"
        },
        {
          "type": "alert",
          "level": "info",
          "text": "**Utiliser les transactions** pour garantir la coh√©rence des donn√©es lors d'op√©rations critiques (transferts bancaires, commandes, etc.)."
        }
      ]
    },
    {
      "id": "index",
      "title": "Index et Optimisation",
      "content": [
        {
          "type": "definition",
          "term": "Index",
          "definition": "Structure de donn√©es qui am√©liore la vitesse des requ√™tes SELECT en cr√©ant un \"index\" des valeurs d'une ou plusieurs colonnes."
        },
        {
          "type": "code",
          "language": "sql",
          "code": "-- Cr√©er un index\nCREATE INDEX idx_email ON users(email);\n\n-- Index sur plusieurs colonnes\nCREATE INDEX idx_nom_prenom ON users(name, firstName);\n\n-- Supprimer un index\nDROP INDEX idx_email ON users;"
        },
        {
          "type": "table",
          "headers": [
            "Avantage",
            "Inconv√©nient"
          ],
          "rows": [
            [
              "Acc√©l√®re les SELECT",
              "Ralentit les INSERT/UPDATE/DELETE"
            ],
            [
              "Am√©liore les JOIN",
              "Occupe de l'espace disque"
            ],
            [
              "Optimise les WHERE et ORDER BY",
              "Maintenance suppl√©mentaire"
            ]
          ]
        },
        {
          "type": "alert",
          "level": "info",
          "text": "**Cr√©er des index** sur les colonnes fr√©quemment utilis√©es dans WHERE, JOIN et ORDER BY."
        }
      ]
    }
  ],
  "keyPoints": [
    "SQL est le langage standard pour interagir avec les bases de donn√©es relationnelles.",
    "LDD (CREATE, ALTER, DROP) d√©finit la structure. LMD (SELECT, INSERT, UPDATE, DELETE) manipule les donn√©es.",
    "Toujours utiliser WHERE avec UPDATE et DELETE pour √©viter de modifier/supprimer toutes les lignes.",
    "Les jointures (JOIN) combinent des donn√©es de plusieurs tables.",
    "INNER JOIN : correspondances uniquement. LEFT JOIN : toutes les lignes de gauche.",
    "Fonctions d'agr√©gation (COUNT, SUM, AVG, MIN, MAX) avec GROUP BY et HAVING.",
    "Les transactions (START TRANSACTION, COMMIT, ROLLBACK) garantissent la coh√©rence des donn√©es.",
    "Les index acc√©l√®rent les SELECT mais ralentissent les INSERT/UPDATE/DELETE."
  ],
  "resources": [
    {
      "type": "doc",
      "title": "SQL Tutorial (W3Schools)",
      "url": "https://www.w3schools.com/sql/"
    },
    {
      "type": "interactive",
      "title": "SQLBolt (apprendre SQL en pratiquant)",
      "url": "https://sqlbolt.com/"
    },
    {
      "type": "doc",
      "title": "PostgreSQL Documentation",
      "url": "https://www.postgresql.org/docs/"
    }
  ]
}