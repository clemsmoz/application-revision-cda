{
  "id": "bloc3-docker",
  "bloc": "bloc3",
  "title": "Docker : Conteneurisation et DevOps",
  "icon": "üê≥",
  "color": "#2496ED",
  "description": "Docker est une plateforme de conteneurisation qui permet de cr√©er, d√©ployer et ex√©cuter des applications dans des environnements isol√©s et portables. C'est un outil essentiel pour le DevOps et le d√©ploiement d'applications.",
  "sections": [
    {
      "id": "intro",
      "title": "Introduction √† Docker",
      "content": [
        {
          "type": "definition",
          "term": "Docker",
          "definition": "Plateforme de virtualisation l√©g√®re qui permet de cr√©er, d√©ployer et ex√©cuter des applications dans des conteneurs isol√©s."
        },
        {
          "type": "paragraph",
          "text": "Docker r√©sout le probl√®me classique : \"√áa marche sur ma machine, mais pas en production\". Les conteneurs garantissent que l'application s'ex√©cute de mani√®re identique partout."
        },
        {
          "type": "table",
          "headers": [
            "Machine Virtuelle (VM)",
            "Conteneur Docker"
          ],
          "rows": [
            [
              "Virtualise le mat√©riel",
              "Virtualise l'OS"
            ],
            [
              "Lourd (plusieurs Go)",
              "L√©ger (quelques Mo)"
            ],
            [
              "D√©marrage lent (minutes)",
              "D√©marrage rapide (secondes)"
            ],
            [
              "Isolation compl√®te",
              "Isolation au level processus"
            ],
            [
              "N√©cessite un hyperviseur",
              "Utilise le noyau de l'h√¥te"
            ]
          ]
        },
        {
          "type": "alert",
          "level": "info",
          "text": "Conteneur ‚â† VM : Un conteneur partage le noyau de l'OS h√¥te, ce qui le rend beaucoup plus l√©ger et rapide."
        }
      ]
    },
    {
      "id": "concepts",
      "title": "Concepts Fondamentaux",
      "content": [
        {
          "type": "subtitle",
          "text": "Image Docker"
        },
        {
          "type": "definition",
          "term": "Image",
          "definition": "Mod√®le en lecture seule contenant tout le n√©cessaire pour ex√©cuter une application (code, d√©pendances, biblioth√®ques, configuration)."
        },
        {
          "type": "paragraph",
          "text": "Les images sont construites √† partir d'un Dockerfile et stock√©es dans un registre (Docker Hub, GitLab Registry, etc.)."
        },
        {
          "type": "subtitle",
          "text": "Conteneur Docker"
        },
        {
          "type": "definition",
          "term": "Conteneur",
          "definition": "Instance en cours d'ex√©cution d'une image. Un conteneur est une application isol√©e qui s'ex√©cute sur l'h√¥te."
        },
        {
          "type": "paragraph",
          "text": "Analogie : Image = Classe, Conteneur = Instance (objet)."
        },
        {
          "type": "table",
          "headers": [
            "Concept",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "Image",
              "Mod√®le statique (template)",
              "nginx:latest, node:18"
            ],
            [
              "Conteneur",
              "Instance en cours d'ex√©cution",
              "Serveur web Nginx active"
            ],
            [
              "Dockerfile",
              "Fichier de configuration pour construire une image",
              "FROM node:18..."
            ],
            [
              "Volume",
              "Stockage persistant partag√© entre h√¥te et conteneur",
              "/data:/app/data"
            ],
            [
              "R√©seau",
              "Communication entre conteneurs",
              "bridge, host, none"
            ]
          ]
        }
      ]
    },
    {
      "id": "installation",
      "title": "Installation et Commandes de Base",
      "content": [
        {
          "type": "subtitle",
          "text": "Installation"
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# Linux (Ubuntu/Debian)\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\n\n# Add l'user au groupe docker (√©viter sudo)\nsudo usermod -aG docker $USER\n\n# V√©rifier l'installation\ndocker --version\ndocker run hello-world"
        },
        {
          "type": "subtitle",
          "text": "Commandes Essentielles"
        },
        {
          "type": "table",
          "headers": [
            "Commande",
            "Description"
          ],
          "rows": [
            [
              "docker pull <image>",
              "T√©l√©charger une image depuis Docker Hub"
            ],
            [
              "docker images",
              "Lister les images locales"
            ],
            [
              "docker run <image>",
              "Cr√©er et d√©marrer un conteneur"
            ],
            [
              "docker ps",
              "Lister les conteneurs en cours d'ex√©cution"
            ],
            [
              "docker ps -a",
              "Lister tous les conteneurs (actifs et arr√™t√©s)"
            ],
            [
              "docker stop <id>",
              "Arr√™ter un conteneur"
            ],
            [
              "docker start <id>",
              "D√©marrer un conteneur arr√™t√©"
            ],
            [
              "docker rm <id>",
              "Supprimer un conteneur"
            ],
            [
              "docker rmi <image>",
              "Supprimer une image"
            ],
            [
              "docker logs <id>",
              "Afficher les logs d'un conteneur"
            ],
            [
              "docker exec -it <id> bash",
              "Ouvrir un shell dans un conteneur"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "Exemple : Lancer un Serveur Nginx"
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# T√©l√©charger l'image Nginx\ndocker pull nginx\n\n# Lancer un conteneur Nginx\ndocker run -d -p 8080:80 --name mon-nginx nginx\n# -d : mode d√©tach√© (arri√®re-plan)\n# -p 8080:80 : mapper le port 8080 de l'h√¥te vers le port 80 du conteneur\n# --name : nommer le conteneur\n\n# Acc√©der √† http://localhost:8080\n\n# Arr√™ter et delete\ndocker stop mon-nginx\ndocker rm mon-nginx"
        }
      ]
    },
    {
      "id": "dockerfile",
      "title": "Dockerfile : Cr√©er des Images",
      "content": [
        {
          "type": "paragraph",
          "text": "Un Dockerfile est un fichier texte contenant les instructions pour construire une image Docker."
        },
        {
          "type": "subtitle",
          "text": "Instructions Principales"
        },
        {
          "type": "table",
          "headers": [
            "Instruction",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "FROM",
              "Image de base",
              "FROM node:18"
            ],
            [
              "WORKDIR",
              "R√©pertoire de travail",
              "WORKDIR /app"
            ],
            [
              "COPY",
              "Copier des files de l'h√¥te vers l'image",
              "COPY . /app"
            ],
            [
              "RUN",
              "Ex√©cuter une order lors de la construction",
              "RUN npm install"
            ],
            [
              "CMD",
              "Commande par d√©faut au d√©marrage du conteneur",
              "CMD [\"node\", \"server.js\"]"
            ],
            [
              "ENTRYPOINT",
              "Point d'entr√©e (non rempla√ßable)",
              "ENTRYPOINT [\"node\"]"
            ],
            [
              "ENV",
              "D√©finir une variable d'environnement",
              "ENV NODE_ENV=production"
            ],
            [
              "EXPOSE",
              "Documenter le port utilis√©",
              "EXPOSE 3000"
            ],
            [
              "VOLUME",
              "D√©finir un volume",
              "VOLUME /data"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "Exemple : Application Node.js"
        },
        {
          "type": "code",
          "language": "dockerfile",
          "code": "# Dockerfile\n# image de database\nFROM node:18-alpine\n\n# R√©pertoire de travail\nWORKDIR /app\n\n# Copier package.json et package-lock.json\nCOPY package*.json ./\n\n# Installer les d√©pendances\nRUN npm install --production\n\n# Copier le code source\nCOPY . .\n\n# Exposer le port\nEXPOSE 3000\n\n# Commande de d√©marrage\nCMD [\"node\", \"server.js\"]"
        },
        {
          "type": "subtitle",
          "text": "Construire et Ex√©cuter"
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# Construire l'image\ndocker build -t mon-app:1.0 .\n\n# Lancer le conteneur\ndocker run -d -p 3000:3000 --name mon-app mon-app:1.0\n\n# V√©rifier les logs\ndocker logs mon-app"
        },
        {
          "type": "alert",
          "level": "info",
          "text": "Bonnes pratiques : Utiliser des images de base l√©g√®res (alpine), copier package.json avant le code source (cache des layers), ne pas inclure node_modules dans l'image."
        }
      ]
    },
    {
      "id": "volumes",
      "title": "Volumes : Persistance des Donn√©es",
      "content": [
        {
          "type": "paragraph",
          "text": "Par d√©faut, les donn√©es d'un conteneur sont √©ph√©m√®res : elles disparaissent quand le conteneur est supprim√©. Les volumes permettent de persister les donn√©es."
        },
        {
          "type": "subtitle",
          "text": "Types de Volumes"
        },
        {
          "type": "table",
          "headers": [
            "Type",
            "Description",
            "Exemple"
          ],
          "rows": [
            [
              "Volume nomm√©",
              "G√©r√© par Docker",
              "docker volume create mon-volume"
            ],
            [
              "Bind mount",
              "Lier un folder de l'h√¥te",
              "-v /home/user/data:/app/data"
            ],
            [
              "tmpfs",
              "Stockage en m√©moire (temporaire)",
              "--tmpfs /tmp"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "Exemple : Base de Donn√©es MySQL"
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# Cr√©er un volume\ndocker volume create mysql-data\n\n# Lancer MySQL avec volume persistant\ndocker run -d \\\n  --name mysql \\\n  -e MYSQL_ROOT_PASSWORD=secret \\\n  -v mysql-data:/var/lib/mysql \\\n  -p 3306:3306 \\\n  mysql:8\n\n# Les donn√©es persistent m√™me if le conteneur est Deleted\ndocker rm -f mysql\ndocker run -d --name mysql -e MYSQL_ROOT_PASSWORD=secret -v mysql-data:/var/lib/mysql -p 3306:3306 mysql:8\n# Les donn√©es sont toujours l√† !"
        }
      ]
    },
    {
      "id": "networks",
      "title": "R√©seaux : Communication entre Conteneurs",
      "content": [
        {
          "type": "paragraph",
          "text": "Les r√©seaux Docker permettent aux conteneurs de communiquer entre eux."
        },
        {
          "type": "table",
          "headers": [
            "Type de R√©seau",
            "Description",
            "Cas d'usage"
          ],
          "rows": [
            [
              "bridge (d√©faut)",
              "R√©seau priv√© isol√©",
              "Conteneurs sur le m√™me h√¥te"
            ],
            [
              "host",
              "Utilise le r√©seau de l'h√¥te",
              "Performances maximales"
            ],
            [
              "none",
              "Aucun r√©seau",
              "Isolation compl√®te"
            ],
            [
              "custom bridge",
              "R√©seau personnalis√©",
              "Communication par name de conteneur"
            ]
          ]
        },
        {
          "type": "subtitle",
          "text": "Exemple : Application + Base de Donn√©es"
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# Cr√©er un r√©seau personnalis√©\ndocker network create mon-reseau\n\n# Lancer MySQL\ndocker run -d --name mysql --network mon-reseau -e MYSQL_ROOT_PASSWORD=secret mysql:8\n\n# Lancer l'application (peut acc√©der √† MySQL via le name \"mysql\")\ndocker run -d --name app --network mon-reseau -e DB_HOST=mysql -p 3000:3000 mon-app:1.0"
        }
      ]
    },
    {
      "id": "docker-compose",
      "title": "Docker Compose : Orchestration Multi-Conteneurs",
      "content": [
        {
          "type": "definition",
          "term": "Docker Compose",
          "definition": "Outil pour d√©finir et ex√©cuter des applications multi-conteneurs √† l'aide d'un fichier YAML."
        },
        {
          "type": "paragraph",
          "text": "Docker Compose simplifie le d√©ploiement d'applications complexes (application + base de donn√©es + cache, etc.)."
        },
        {
          "type": "subtitle",
          "text": "Exemple : Application Node.js + MySQL"
        },
        {
          "type": "code",
          "language": "yaml",
          "code": "# docker-compose.yml\nversion: '3.8'\n\nservices:\n  # database de donn√©es MySQL\n  db:\n    image: mysql:8\n    environment:\n      MYSQL_ROOT_PASSWORD: secret\n      MYSQL_DATABASE: myapp\n    volumes:\n      - db-data:/var/lib/mysql\n    networks:\n      - app-network\n\n  # Application Node.js\n  app:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      DB_HOST: db\n      DB_USER: root\n      DB_PASSWORD: secret\n      DB_NAME: myapp\n    depends_on:\n      - db\n    networks:\n      - app-network\n\nvolumes:\n  db-data:\n\nnetworks:\n  app-network:"
        },
        {
          "type": "subtitle",
          "text": "Commandes Docker Compose"
        },
        {
          "type": "table",
          "headers": [
            "Commande",
            "Description"
          ],
          "rows": [
            [
              "docker-compose up",
              "D√©marrer tous les services"
            ],
            [
              "docker-compose up -d",
              "D√©marrer en arri√®re-plan"
            ],
            [
              "docker-compose down",
              "Arr√™ter et supprimer les conteneurs"
            ],
            [
              "docker-compose ps",
              "Lister les services"
            ],
            [
              "docker-compose logs",
              "Afficher les logs"
            ],
            [
              "docker-compose exec <service> bash",
              "Ouvrir un shell dans un service"
            ],
            [
              "docker-compose build",
              "Reconstruire les images"
            ],
            [
              "docker-compose restart",
              "Red√©marrer les services"
            ]
          ]
        },
        {
          "type": "code",
          "language": "bash",
          "code": "# D√©marrer l'application compl√®te\ndocker-compose up -d\n\n# V√©rifier les logs\ndocker-compose logs -f app\n\n# Arr√™ter et nettoyer\ndocker-compose down"
        }
      ]
    },
    {
      "id": "best-practices",
      "title": "Bonnes Pratiques",
      "content": [
        {
          "type": "subtitle",
          "text": "Optimisation des Images"
        },
        {
          "type": "list",
          "items": [
            "Utiliser des images de base l√©g√®res : alpine, slim",
            "Multi-stage builds : s√©parer la construction et l'ex√©cution",
            "Minimiser les layers : regrouper les commandes RUN",
            "Utiliser .dockerignore : exclure node_modules, .git, etc.",
            "Ne pas ex√©cuter en root : cr√©er un utilisateur non-privil√©gi√©"
          ]
        },
        {
          "type": "subtitle",
          "text": "Exemple : Multi-Stage Build"
        },
        {
          "type": "code",
          "language": "dockerfile",
          "code": "# √âtape 1 : Construction\nFROM node:18-alpine AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nRUN npm run build\n\n# √âtape 2 : Production\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCMD [\"node\", \"dist/server.js\"]"
        },
        {
          "type": "subtitle",
          "text": "S√©curit√©"
        },
        {
          "type": "list",
          "items": [
            "Ne pas stocker de secrets dans l'image : utiliser des variables d'environnement ou des secrets managers",
            "Scanner les vuln√©rabilit√©s : docker scan, Trivy, Snyk",
            "Mettre √† jour r√©guli√®rement les images de base",
            "Limiter les ressources : --memory, --cpus"
          ]
        }
      ]
    },
    {
      "id": "devops",
      "title": "Docker et DevOps",
      "content": [
        {
          "type": "paragraph",
          "text": "Docker est un pilier du DevOps et de l'Infrastructure as Code (IaC)."
        },
        {
          "type": "subtitle",
          "text": "CI/CD avec Docker"
        },
        {
          "type": "code",
          "language": "yaml",
          "code": "# Exemple : GitLab CI/CD\nstages:\n  - build\n  - test\n  - deploy\n\nbuild:\n  stage: build\n  script:\n    - docker build -t mon-app:$CI_COMMIT_SHA .\n    - docker push mon-app:$CI_COMMIT_SHA\n\ntest:\n  stage: test\n  script:\n    - docker run mon-app:$CI_COMMIT_SHA npm test\n\ndeploy:\n  stage: deploy\n  script:\n    - docker pull mon-app:$CI_COMMIT_SHA\n    - docker-compose up -d"
        },
        {
          "type": "subtitle",
          "text": "Orchestration"
        },
        {
          "type": "paragraph",
          "text": "Pour les applications complexes en production, utiliser des orchestrateurs :"
        },
        {
          "type": "table",
          "headers": [
            "Outil",
            "Description",
            "Cas d'usage"
          ],
          "rows": [
            [
              "Docker Swarm",
              "Orchestrateur simple int√©gr√© √† Docker",
              "Petites applications"
            ],
            [
              "Kubernetes",
              "Orchestrateur puissant et complexe",
              "Applications √† grande √©chelle"
            ],
            [
              "AWS ECS",
              "Service AWS pour conteneurs",
              "Infrastructure AWS"
            ],
            [
              "Nomad",
              "Orchestrateur l√©ger (HashiCorp)",
              "Alternative √† Kubernetes"
            ]
          ]
        }
      ]
    }
  ],
  "keyPoints": [
    "Docker permet de cr√©er des conteneurs l√©gers et portables pour ex√©cuter des applications.",
    "Conteneur ‚â† VM : un conteneur partage le noyau de l'OS h√¥te (plus l√©ger et rapide).",
    "Image = mod√®le statique, Conteneur = instance en cours d'ex√©cution.",
    "Dockerfile : fichier de configuration pour construire une image (FROM, RUN, CMD, COPY).",
    "Volumes : persistance des donn√©es (volumes nomm√©s, bind mounts).",
    "R√©seaux : communication entre conteneurs (bridge, host, custom).",
    "Docker Compose : orchestration multi-conteneurs avec un fichier YAML.",
    "Bonnes pratiques : images l√©g√®res (alpine), multi-stage builds, .dockerignore, s√©curit√©."
  ],
  "resources": [
    {
      "type": "doc",
      "title": "Documentation officielle Docker",
      "url": "https://docs.docker.com/"
    },
    {
      "type": "doc",
      "title": "Docker Compose",
      "url": "https://docs.docker.com/compose/"
    },
    {
      "type": "interactive",
      "title": "Play with Docker (environnement en ligne)",
      "url": "https://labs.play-with-docker.com/"
    }
  ]
}